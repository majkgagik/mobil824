<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Saya</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>MOBIL KPP 824</h1>
    <p id="paragraf">Laman Booking KDO Mobil KPP Pratama Kotamobagu.</p>
  <style>
    :root{--bg:#f6f8fa;--card:#fff;--accent:#2563eb;--muted:#6b7280}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#0f172a}
    .container{max-width:980px;margin:36px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:20px;margin-top:18px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
    label{display:block;font-size:13px;margin-top:10px;color:var(--muted)}
    select,input[type=date]{width:100%;padding:8px;margin-top:6px;border-radius:8px;border:1px solid #e6eef8}
    button{background:var(--accent);color:#fff;padding:10px 12px;border:none;border-radius:10px;margin-top:12px;cursor:pointer}
    .cars-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .car-item{display:flex;justify-content:space-between;padding:10px;border-radius:8px;border:1px solid #e6eef8}
    .bookings-list{margin-top:12px}
    .booking{padding:10px;border-radius:8px;border:1px solid #eef2ff;margin-bottom:8px;background:linear-gradient(180deg,#fff,#fbfdff)}
    .muted{color:var(--muted);font-size:13px}
    .error{color:#b91c1c;font-size:13px;margin-top:8px}
    footer{margin-top:18px;font-size:13px;color:var(--muted)}
    @media (max-width:820px){.grid{grid-template-columns:1fr;}.container{padding:12px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Peminjaman Mobil</h1>
    </header>

    <div class="grid">
      <!-- Form Panel -->
      <div class="card">
        <strong>Tambah Booking</strong>
        <form id="bookingForm" onsubmit="return false;">
          <label for="car">Pilih Mobil</label>
          <select id="car" required>
            <option value="Rush 1284">Rush 1284</option>
            <option value="Rush 1288">Rush 1288</option>
            <option value="Innova 1118">Innova 1118</option>
            <option value="Strada 8130">Strada 8130</option>
            <option value="Venturer 2859">Venturer 2859</option>
          </select>

          <label for="start">Tanggal Mulai</label>
          <input id="start" type="date" required />

          <label for="end">Tanggal Selesai</label>
          <input id="end" type="date" required />

          <label for="name">Nama Penyewa</label>
          <input id="name" type="text" placeholder="Nama" required />
            
          <label for="name">Seksi</label>
          <select id="seksi" required>
            <option value=>pilih seksi</option>
            <option value=>SUKI</option>
            <option value=>WAS I</option>
            <option value=>WAS II</option>
            <option value=>WAS III</option>
            <option value=>WAS IV</option>
            <option value=>WAS V</option>
            <option value=>P3</option>
            <option value=>PKD</option>
            <option value=>Pelayanan</option>
            <option value=>FPP</option>
          </select>

          <div id="error" class="error" aria-live="polite" style="display:none"></div>

            
          <button id="saveBtn">Simpan Booking</button>
        </form>

        <div style="margin-top:14px">
          <button id="clearBtn" style="background:#ef4444">Hapus Semua Booking</button>
        </div>
      </div>

      <!-- Bookings & Cars Panel -->
      <div>
        <div class="card">
          <strong>Daftar Mobil</strong>
          <div class="cars-list" id="carsList"></div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Daftar Booking</strong>
          <div class="bookings-list" id="bookingsList" id="bookingsList"></div>
        </div>

      </div>
    </div>

    <footer>Catatan: Validasi bentrok hanya berlaku per nomor mobil. Anda bisa menyimpan halaman ini di browser atau mengimpor/ekspor data melalui localStorage.</footer>
  </div>

  <script>
    // Simple client-side booking manager with localStorage persistence
    const CARS = ["Rush 1284","Rush 1288","Innova 1118","Strada 8130","Venturer 2859"];
    const STORAGE_KEY = 'peminjaman_mobil_bookings_v1';

    function loadBookings(){
      try{
        return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
      }catch(e){return []}
    }
    function saveBookings(b){ localStorage.setItem(STORAGE_KEY, JSON.stringify(b)); }

    // UI refs
    const carsList = document.getElementById('carsList');
    const bookingsList = document.getElementById('bookingsList');
    const form = document.getElementById('bookingForm');
    const carEl = document.getElementById('car');
    const startEl = document.getElementById('start');
    const endEl = document.getElementById('end');
    const nameEl = document.getElementById('name');
    const errorEl = document.getElementById('error');
    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clearBtn');

    let bookings = loadBookings();

    // Helpers
    function fmtDate(d){
      const dt = new Date(d);
      if (isNaN(dt)) return d;
      return dt.toLocaleDateString('id-ID');
    }
    function iso(d){ // keep yyyy-mm-dd
      if (!d) return '';
      const t = new Date(d);
      if (isNaN(t)) return '';
      return t.toISOString().slice(0,10);
    }

    function rangesOverlap(aStart,aEnd,bStart,bEnd){
      // inputs as yyyy-mm-dd strings
      return (aStart <= bEnd) && (aEnd >= bStart);
    }

    function validateNoOverlap(car, s, e){
      // check bookings for same car
      const same = bookings.filter(b => b.car === car);
      for (const b of same){
        if (rangesOverlap(s,e,b.start,b.end)) return {ok:false, conflict:b};
      }
      return {ok:true};
    }

    // Render functions
    function renderCars(){
      carsList.innerHTML = '';
      for (const c of CARS){
        const node = document.createElement('div');
        node.className = 'car-item';
        const total = bookings.filter(b=>b.car===c).length;
        node.innerHTML = `<div><strong>${c}</strong><div class="muted">Total booking: ${total}</div></div><div><button onclick="showCarBookings('${c.replace(/'/g,"\\'")}')">Lihat</button></div>`;
        carsList.appendChild(node);
      }
    }

    function renderBookings(){
      bookingsList.innerHTML = '';
      if (bookings.length===0){ bookingsList.innerHTML = '<div class="muted">Belum ada booking.</div>'; return; }
      // sort by start date
      bookings.sort((a,b)=> a.start.localeCompare(b.start));
      for (const b of bookings){
        const item = document.createElement('div');
        item.className = 'booking';
        item.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${b.car}</strong><div class="muted">${fmtDate(b.start)} — ${fmtDate(b.end)} • ${b.name}</div></div><div><button onclick="removeBooking('${b.id}')">Hapus</button></div></div>`;
        bookingsList.appendChild(item);
      }
    }

    // Show only bookings for a car
    window.showCarBookings = function(car){
      const filtered = bookings.filter(b=>b.car===car).sort((a,b)=>a.start.localeCompare(b.start));
      if (filtered.length===0){ alert('Tidak ada booking untuk '+car); return; }
      const lines = filtered.map(b=>`${b.name}: ${fmtDate(b.start)} — ${fmtDate(b.end)}`);
      alert(car + '\n\n' + lines.join('\n'));
    }

    // Create booking
    saveBtn.addEventListener('click', ()=>{
      errorEl.style.display='none';
      const car = carEl.value;
      const s = iso(startEl.value);
      const e = iso(endEl.value);
      const name = nameEl.value.trim();
      if (!car || !s || !e || !name){ error('Lengkapi semua field.'); return; }
      if (s > e){ error('Tanggal mulai tidak boleh setelah tanggal selesai.'); return; }

      const valid = validateNoOverlap(car,s,e);
      if (!valid.ok){
        error(`Gagal: bentrok dengan booking ${valid.conflict.name} (${fmtDate(valid.conflict.start)} — ${fmtDate(valid.conflict.end)})`);
        return;
      }

      const newBooking = { id: 'b'+Date.now(), car, start: s, end: e, name };
      bookings.push(newBooking);
      saveBookings(bookings);
      renderBookings();
      renderCars();
      form.reset();
      alert('Booking berhasil disimpan.');
    });

    function error(msg){ errorEl.textContent = msg; errorEl.style.display='block'; }

    // Remove booking
    window.removeBooking = function(id){
      if(!confirm('Hapus booking ini?')) return;
      bookings = bookings.filter(b=>b.id!==id);
      saveBookings(bookings);
      renderBookings();
      renderCars();
    }

    clearBtn.addEventListener('click', ()=>{
      if (!confirm('Hapus semua booking?')) return;
      bookings = [];
      saveBookings(bookings);
      renderBookings();
      renderCars();
    })

    // init
    renderCars();
    renderBookings();

    // Expose for debugging
    window._BM = {get: ()=>bookings, save: ()=>saveBookings(bookings)};

  </script>
</body>
</html>






